<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Matti Vuorre" />

<meta name="date" content="2016-09-02" />

<title>Questionnaire data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #dddddd; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; } /* Keyword */
code > span.dt { color: #800000; } /* DataType */
code > span.dv { color: #0000ff; } /* DecVal */
code > span.bn { color: #0000ff; } /* BaseN */
code > span.fl { color: #800080; } /* Float */
code > span.ch { color: #ff00ff; } /* Char */
code > span.st { color: #dd0000; } /* String */
code > span.co { color: #808080; font-style: italic; } /* Comment */
code > span.al { color: #00ff00; font-weight: bold; } /* Alert */
code > span.fu { color: #000080; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #ff0000; font-weight: bold; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #ff00ff; } /* SpecialChar */
code > span.vs { color: #dd0000; } /* VerbatimString */
code > span.ss { color: #dd0000; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #808080; font-style: italic; } /* Documentation */
code > span.an { color: #808080; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #808080; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #808080; font-weight: bold; font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Toolbox
  </a>
</li>
<li>
  <a href="introduction.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-download"></span>
     
    Import
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="import.html">Spreadsheets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    Wrangle
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="questionnaire.html">Questionnaire data</a>
    </li>
    <li>
      <a href="reshape.html">Reshaping data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Visualize
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="plotting.html">Intro to ggplot2</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mvuorre/toolbox">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Questionnaire data</h1>
<h4 class="author"><em>Matti Vuorre</em></h4>
<h4 class="date"><em>2016-09-02</em></h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>For this project we’ll be using a real data set, consisting of 19,719 individual’s responses to 50 questionnaire items that together constitute the Big Five personality scale. Additionally, each respondent provided their gender, age, race, native language and country. With this many respondents, items responded to, and categories by which we can split the responses, we can get answers to a rich set of questions. The data set is available <a href="http://personality-testing.info/_rawdata/BIG5.zip">here</a>, and you can complete the scale yourself on <a href="http://personality-testing.info/">this website</a>.</p>
<p>Before we begin wrangling the data, we’ll go through an extremely important topic: Project Organization.</p>
</div>
<div id="organizing-a-project" class="section level1">
<h1>Organizing a Project</h1>
<p>While there is no single way to organize a project that would fit every situation, it is imperative that every project have some organizing principles that help the participants in the project find and execute the files within the project. Therefore, before the project is initiated, you need to think about what it is about, what are the likely inputs (e.g. “spreadsheet” type data files, large scale databases, photographs, biological samples) and outputs (e.g. manuscripts, data figures, presentations.) These considerations will heavily narrow down the possible ways in which the project can be organized.</p>
<p>We will be working with a fairly simple, but I think common, situation where we have one “spreadsheet” like data file, intend to keep this file on one computer, and produce figures and simple reports from the data. Therefore, we’ll set out to define a clear folder structure for our files. A folder structure helps us keep track of our files, ensure that we know what are the inputs (never overwrite / edit the source data!) and how to turn the inputs into outputs. The folder structure I’ve chosen for this project is displayed below:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">toolbox</span>
<span class="kw">|--</span> questionnaire.Rmd  <span class="co"># This file!</span>
<span class="kw">|--</span> data
<span class="kw">|</span>   <span class="kw">|--</span> big5
<span class="kw">|</span>       <span class="kw">|--</span> data.csv
<span class="kw">|</span>       <span class="kw">|--</span> codebook.txt</code></pre></div>
<p><small>This is not the only “correct” structure, but something that makes sense to me and is easy to explain to others. By all means in your own projects use one that suits your needs better.</small></p>
<p>I view a clear folder structure as the first step toward a reproducible research project. By adhering to a simple scheme like this, my future collaborators–including myself!–will almost immediately know how to locate any files they need to do their jobs. If I end up collaborating with you, and your project looks like the figure on the left, below, I <em>will</em> call you at 3am and ask you to fix it asap. The one on the right gives an idea of what a good organization might look like.</p>
<p><img src="images/bad_data_good_data.png" height="400px"></p>
<p>If you downloaded all of the <a href="https://mvuorre.github.io/toolbox/">Toolbox 2.0</a> materials, you already have this file structure ready under the root folder <code>/toolbox/</code>, and can now browse your way to these folders on your computer, and inspect their contents.</p>
</div>
<div id="prepare-a-session-in-rstudio" class="section level1">
<h1>Prepare a session in RStudio</h1>
<p>Before we can access the data in RStudio, we need to set the working directory. Do <strong>not</strong> set working directories in your script, because these calls make others with different root folder structures (usernames, systems, etc.) unable to run your script without changing these arguments. Instead, you can simply click the Set As Working Directory button in RStudio as described in <a href="http://mvuorre.github.io/toolbox/rrstudio/rrstudio.html#Get_started_with_RStudio">here</a>.</p>
<p>The raw data downloaded from the <a href="http://personality-testing.info/_rawdata/BIG5.zip">website</a> is a neat and simple spreadsheet of data, which we will load into the R workspace.</p>
</div>
<div id="load-the-data" class="section level1">
<h1>Load the data</h1>
<p>The first step is to load the source data file into the current R environment, or workspace. To load the data, we use a function called <code>read_tsv()</code> from the <code>readr</code> package <span class="citation">(Wickham &amp; Francois, 2015b)</span>. <code>read_tsv()</code> takes <em>tab-separated</em> data tables as input, which is appropriate in this case.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)  <span class="co"># Loads the readr package into the current workspace</span>
d &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/big5/data.csv&quot;</span>) 
d &lt;-<span class="st"> </span><span class="kw">na.omit</span>(d)  <span class="co"># Remove all missing values</span></code></pre></div>
<p>Usually at this stage you would probably already know quite a bit about the data, if you collected it yourself. Here we get familiar with the data for this example: The data consist of responses to the Big Five personality questionnaire, and we have indicator variables for the country, age, sex, race, etc. of the respondent. Plenty to explore!</p>
<blockquote>
<p>This data was collected (c. 2012) through on interactive online personality test. Participants were informed that their responses would be recorded and used for research at the begining of the test and asked to confirm their consent at the end of the test.</p>
</blockquote>
<p>You can simply type the name of the object (<code>d</code>) in the r console to print it (only 10 first columns shown below):</p>
<table>
<thead>
<tr class="header">
<th align="right">race</th>
<th align="right">age</th>
<th align="right">engnat</th>
<th align="right">gender</th>
<th align="right">hand</th>
<th align="right">source</th>
<th align="left">country</th>
<th align="right">E1</th>
<th align="right">E2</th>
<th align="right">E3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">53</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">US</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">46</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">US</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">14</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">PK</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">19</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">RO</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">25</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">US</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">31</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">US</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>We have a <code>data_frame</code> named <code>d</code> that contains 19710 observations on 57 variables: Each variable is contained in a column, with the top entry (<code>race</code>, <code>age</code>, …) giving names to the variables.</p>
</div>
<div id="recode-and-summarise-variables" class="section level1">
<h1>Recode and summarise variables</h1>
<p>Now that we’re a little more familiar with the data, we can begin to manipulate it. Here, we’ll</p>
<ul>
<li><a href="#Recode_variables">recode variables</a>
<ul>
<li>new tool: <code>mutate()</code></li>
</ul></li>
<li><a href="#Basic_summaries">obtain basic summaries of categorical variables</a>
<ul>
<li>new tools: <code>table()</code> and <code>prop.table()</code></li>
</ul></li>
</ul>
<div id="recode-variables" class="section level2">
<h2>Recode variables</h2>
<p>Here we encounter the first of many perils of not organizing and curating your materials well: Although we know what race means (maybe?), the numbers don’t make any sense. What is race 13? The authors of course have provided a codebook (it’s now in the <code>questionnaire/data/</code> folder), but such an external file requires us to switch back and forth between different files and different programs for viewing those files to understand our data, and I strongly recommend writing <strong>human-readable</strong> variable names and code so that we don’t need to go back and forth between the data and its related codebook. The first step, therefore, is to make the data as close to human-readable as possible.</p>
<p>For this task, we’ll pick up another tool: the <code>mutate()</code> function in the <code>dplyr</code> package <span class="citation">(Wickham &amp; Francois, 2015a)</span>.</p>
<p>The following code takes <code>d</code> and converts <code>race</code>, <code>engnat</code>, <code>gender</code>, and <code>hand</code> into more readable <strong>factors</strong>.</p>
<div class="row">
<div class="col-md-1">

</div>
<div class="col-md-10">
<p>People used to code verbal data as numerical codes back in 2012. That’s why we have data sets such as this one, where we have values of <code>race</code> such as 13. With modern computing power, we might as well use meaningful labels for our data, and enter values of <code>race</code> such as “caucasian”. However, these numerical codes for non-numerical data are extremely common, and R treats them as <strong>factors</strong>. Factors are numbers in the data frame, to which R attaches verbal labels (so the actual data frame contains numbers, but prints out verbal labels.) Arguably, it would be better to use character strings from the get-go, but the given data are easier to deal with if we recode the number codes into factors, as will be shown below.</p>
</div>
<div class="col-md-1">

</div>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
d &lt;-<span class="st"> </span><span class="kw">mutate</span>(
    d, 
    <span class="co"># Change race into a factor with the following verbal labels</span>
    <span class="dt">race =</span> <span class="kw">factor</span>(race, 
                  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;no_response&quot;</span>, 
                             <span class="st">&quot;mixed_race&quot;</span>,
                             <span class="st">&quot;arctic&quot;</span>,
                             <span class="st">&quot;caucasian_european&quot;</span>,
                             <span class="st">&quot;caucasian_indian&quot;</span>,
                             <span class="st">&quot;caucasian_middle_east&quot;</span>,
                             <span class="st">&quot;caucasian_n_africa_other&quot;</span>,
                             <span class="st">&quot;indigenous_australian&quot;</span>,
                             <span class="st">&quot;native_american&quot;</span>,
                             <span class="st">&quot;north_east_asian&quot;</span>,
                             <span class="st">&quot;pacific&quot;</span>,
                             <span class="st">&quot;south_east_asian&quot;</span>,
                             <span class="st">&quot;west_african&quot;</span>,
                             <span class="st">&quot;other&quot;</span>)),
    <span class="co"># Ditto for English as native language</span>
    <span class="dt">engnat =</span> <span class="kw">factor</span>(engnat,
                    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;no_response&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),
    <span class="co"># ...Gender...</span>
    <span class="dt">gender =</span> <span class="kw">factor</span>(gender,
                    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;no_response&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;other&quot;</span>)),
    <span class="co"># ...And handedness</span>
    <span class="dt">hand =</span> <span class="kw">factor</span>(hand,
                  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;no_response&quot;</span>, <span class="st">&quot;right&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="st">&quot;both&quot;</span>))
)</code></pre></div>
<p>Before we view the output, let’s reflect on what we just did. We took <code>d</code> and passed it as the first argument to <code>mutate()</code>. <code>mutate()</code> is a powerful function from the <code>dplyr</code> package that takes a data frame as input, and creates new variables within that data frame. We overwrote the original variables by calls to <code>factor()</code>, which simply converts the old variable, for example <code>race</code>, by a new one that took the numerical values of <code>race</code> and attached them with verbal labels. Of course, instead of overwriting the old variables, you could create new ones by giving them different names.</p>
<p>Let’s see what we ended up with:</p>
<table>
<thead>
<tr class="header">
<th align="left">race</th>
<th align="right">age</th>
<th align="left">engnat</th>
<th align="left">gender</th>
<th align="left">hand</th>
<th align="right">source</th>
<th align="left">country</th>
<th align="right">E1</th>
<th align="right">E2</th>
<th align="right">E3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">caucasian_european</td>
<td align="right">53</td>
<td align="left">yes</td>
<td align="left">male</td>
<td align="left">right</td>
<td align="right">1</td>
<td align="left">US</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">other</td>
<td align="right">46</td>
<td align="left">yes</td>
<td align="left">female</td>
<td align="left">right</td>
<td align="right">1</td>
<td align="left">US</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">mixed_race</td>
<td align="right">14</td>
<td align="left">no</td>
<td align="left">female</td>
<td align="left">right</td>
<td align="right">1</td>
<td align="left">PK</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">caucasian_european</td>
<td align="right">19</td>
<td align="left">no</td>
<td align="left">female</td>
<td align="left">right</td>
<td align="right">1</td>
<td align="left">RO</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">south_east_asian</td>
<td align="right">25</td>
<td align="left">no</td>
<td align="left">female</td>
<td align="left">right</td>
<td align="right">2</td>
<td align="left">US</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">other</td>
<td align="right">31</td>
<td align="left">yes</td>
<td align="left">female</td>
<td align="left">right</td>
<td align="right">2</td>
<td align="left">US</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>Much better! Now we can immediately see meaningful values of race, gender, etc. See <a href="multisource.html#Bonus_round">here</a> for how to change the two-letter country codes to actual country names.</p>
</div>
<div id="basic-summaries" class="section level2">
<h2>Basic summaries</h2>
<p>There are a few basic commands that are well worth knowing. <code>table()</code> provides counts of observations for a given variable. To get a single variable (column) from our data frame, we use the <code>$</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$race)</code></pre></div>
<pre><code>## 
##              no_response               mixed_race                   arctic 
##                      153                     1433                       14 
##       caucasian_european         caucasian_indian    caucasian_middle_east 
##                    10535                     1518                      514 
## caucasian_n_africa_other    indigenous_australian          native_american 
##                      397                       24                      201 
##         north_east_asian                  pacific         south_east_asian 
##                      188                       65                     1861 
##             west_african                    other 
##                      257                     2550</code></pre>
<p><code>table()</code> can also be applied on many variables, to obtain n-dimensional tables of counts. Anything above two dimensions will be hard to see, but two dimensions can be very informative:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(d$race, d$engnat)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">no_response</th>
<th align="right">yes</th>
<th align="right">no</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>no_response</td>
<td align="right">2</td>
<td align="right">120</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td>mixed_race</td>
<td align="right">4</td>
<td align="right">1046</td>
<td align="right">383</td>
</tr>
<tr class="odd">
<td>arctic</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td>caucasian_european</td>
<td align="right">47</td>
<td align="right">7945</td>
<td align="right">2543</td>
</tr>
<tr class="odd">
<td>caucasian_indian</td>
<td align="right">0</td>
<td align="right">321</td>
<td align="right">1197</td>
</tr>
<tr class="even">
<td>caucasian_middle_east</td>
<td align="right">2</td>
<td align="right">227</td>
<td align="right">285</td>
</tr>
<tr class="odd">
<td>caucasian_n_africa_other</td>
<td align="right">1</td>
<td align="right">326</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td>indigenous_australian</td>
<td align="right">1</td>
<td align="right">19</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td>native_american</td>
<td align="right">1</td>
<td align="right">158</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td>north_east_asian</td>
<td align="right">0</td>
<td align="right">95</td>
<td align="right">93</td>
</tr>
<tr class="odd">
<td>pacific</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td>south_east_asian</td>
<td align="right">4</td>
<td align="right">549</td>
<td align="right">1308</td>
</tr>
<tr class="odd">
<td>west_african</td>
<td align="right">0</td>
<td align="right">164</td>
<td align="right">93</td>
</tr>
<tr class="even">
<td>other</td>
<td align="right">8</td>
<td align="right">1362</td>
<td align="right">1180</td>
</tr>
</tbody>
</table>
<p>The rows of this table display information for each race, and the separate columns are counts for each “english as a native language” category. It looks like we have a pretty English-centric sample, but unsurprisingly some race-categories are more English-centric than others. To obtain proportions, instead of counts, the <code>prop.table()</code> function is useful:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>(<span class="kw">table</span>(d$race, d$engnat), <span class="dt">margin =</span> <span class="dv">1</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">no_response</th>
<th align="right">yes</th>
<th align="right">no</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>no_response</td>
<td align="right">0.0130719</td>
<td align="right">0.7843137</td>
<td align="right">0.2026144</td>
</tr>
<tr class="even">
<td>mixed_race</td>
<td align="right">0.0027913</td>
<td align="right">0.7299372</td>
<td align="right">0.2672715</td>
</tr>
<tr class="odd">
<td>arctic</td>
<td align="right">0.0000000</td>
<td align="right">0.6428571</td>
<td align="right">0.3571429</td>
</tr>
<tr class="even">
<td>caucasian_european</td>
<td align="right">0.0044613</td>
<td align="right">0.7541528</td>
<td align="right">0.2413859</td>
</tr>
<tr class="odd">
<td>caucasian_indian</td>
<td align="right">0.0000000</td>
<td align="right">0.2114625</td>
<td align="right">0.7885375</td>
</tr>
<tr class="even">
<td>caucasian_middle_east</td>
<td align="right">0.0038911</td>
<td align="right">0.4416342</td>
<td align="right">0.5544747</td>
</tr>
<tr class="odd">
<td>caucasian_n_africa_other</td>
<td align="right">0.0025189</td>
<td align="right">0.8211587</td>
<td align="right">0.1763224</td>
</tr>
<tr class="even">
<td>indigenous_australian</td>
<td align="right">0.0416667</td>
<td align="right">0.7916667</td>
<td align="right">0.1666667</td>
</tr>
<tr class="odd">
<td>native_american</td>
<td align="right">0.0049751</td>
<td align="right">0.7860697</td>
<td align="right">0.2089552</td>
</tr>
<tr class="even">
<td>north_east_asian</td>
<td align="right">0.0000000</td>
<td align="right">0.5053191</td>
<td align="right">0.4946809</td>
</tr>
<tr class="odd">
<td>pacific</td>
<td align="right">0.0000000</td>
<td align="right">0.5384615</td>
<td align="right">0.4615385</td>
</tr>
<tr class="even">
<td>south_east_asian</td>
<td align="right">0.0021494</td>
<td align="right">0.2950027</td>
<td align="right">0.7028479</td>
</tr>
<tr class="odd">
<td>west_african</td>
<td align="right">0.0000000</td>
<td align="right">0.6381323</td>
<td align="right">0.3618677</td>
</tr>
<tr class="even">
<td>other</td>
<td align="right">0.0031373</td>
<td align="right">0.5341176</td>
<td align="right">0.4627451</td>
</tr>
</tbody>
</table>
<p>We fed the <code>engnat</code>-by<code>race</code> table to <code>prop.table()</code>, and specified that we want proportions on the first margin. R treats two-dimensional data first by row, second by column. That’s why, whenever you want to specify if you’d like to operate on rows or columns, remember that one means row, and two means column.</p>
</div>
</div>
<div id="intermission" class="section level1">
<h1>Intermission</h1>
<p>This is taking a while! Are you still following? Let’s take a step back and think about what the goal here is: We want to understand the data in front of us. In order to accomplish this, we must know how to effectively wrangle the data; to group it in various ways, to aggregate it at multiple levels of different grouping factors. We want to be able to quickly draw figures like the one I’ll show below:</p>
<div class="figure" style="text-align: center">
<img src="questionnaire_files/figure-html/unnamed-chunk-3-1.png" alt="Distributions of four of the Big Five categories across various countries" width="768" />
<p class="caption">
Distributions of four of the Big Five categories across various countries
</p>
</div>
<p>This figure took me about 10 minutes to make. But if I want to change something in it (aesthetics, grouping variables, exclude or include more data, manipulations…), it will take me about 20 seconds and the plot is redrawn with the desired changes. Do that in SPSS or Excel! And this is the point, we want to be able to <em>quickly</em> investigate our data from multiple angles. We’ll learn just that in the next section.</p>
</div>
<div id="more-summaries" class="section level1">
<h1>More summaries</h1>
<p>We now understand the basics of the data set, and can compute simple summaries of it. In this section we’ll move on to more advanced summaries, and</p>
<ul>
<li>summarise variables
<ul>
<li>new tools: <code>range()</code> and <code>summarise()</code></li>
</ul></li>
<li>summarise variables at various levels of other variables
<ul>
<li>new tool: <code>group_by()</code></li>
<li>bonus round: the pipe <code>%&gt;%</code></li>
</ul></li>
<li>summarise variables row-wise</li>
<li>subset and filter the data
<ul>
<li>new tools: <code>select()</code> and <code>filter()</code></li>
</ul></li>
<li>draw our first plot
<ul>
<li>new tool: <code>ggplot()</code></li>
</ul></li>
</ul>
<p>There will be a lot of material here, but you can take as long as you wish. If at this stage you haven’t done so, I strongly recommend following along by writing the commands to your own R script, and executing them on your own computer.</p>
<div id="summarise-variables" class="section level2">
<h2>Summarise variables</h2>
<p>Previously, we summarised categorical variables by looking at their counts using <code>table()</code> and <code>prop.table()</code>. Next, we’ll learn how to summarise continuous data using <code>range()</code>, and then take multiple ranges at once using <code>summarise()</code>.</p>
<p>To get the range of one continuous variable, we can use R’s built-in function <code>range()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(d$age)</code></pre></div>
<pre><code>## [1]        13 999999999</code></pre>
<p>And we get two numbers, the lower limit, 13, and the upper limit, 999999999! We clearly have some work to do to clean this data. This result highlights an important point about data analysis: Although the raw data is the most accurate representation of itself (duh), it is not necessarily the most accurate representation of reality. Respondents might very well type 99999999 in the age field, but we doubt the validity of that response. Therefore, we understand that one over-arching goal of initial data-wrangling is to clean the data from clearly inaccurate values. It would be a mistake to start drawing conclusions from the raw data without first inspecting it; here we are learning precisely how to accomplish this task effectively, and <em>with style</em>.</p>
<p>Before we get to filtering bad values, and selecting variables of interest, let’s familiare ourselves with <code>summarise()</code>, <code>dplyr</code>’s function for obtaining various summaries from a data frame. We will compute means for the extraversion items:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(d,
          <span class="dt">mE1 =</span> <span class="kw">mean</span>(E1),
          <span class="dt">mE2 =</span> <span class="kw">mean</span>(E2),
          <span class="dt">mE3 =</span> <span class="kw">mean</span>(E3))</code></pre></div>
<pre><code>## Source: local data frame [1 x 3]
## 
##        mE1      mE2      mE3
##      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 2.629224 2.759767 3.416794</code></pre>
<p>Notice, again, that we can evaluate many functions on our data frame without naming it each time a variable is called. Because <code>summarise()</code> takes a data frame as input, and then operates on its variables, I prefer using it instead of typing out the commands required by base-R functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(
    <span class="dt">mE1 =</span> <span class="kw">mean</span>(d$E1),
    <span class="dt">mE2 =</span> <span class="kw">mean</span>(d$E2),
    <span class="dt">mE3 =</span> <span class="kw">mean</span>(d$E3)
)</code></pre></div>
<pre><code>##      mE1      mE2      mE3 
## 2.629224 2.759767 3.416794</code></pre>
<p>Furthermore, <code>summarise()</code> takes as input a data frame, and outputs a data frame. This will become very important later on. Another unfortunate consequence of not using <code>summarise()</code> here was that I wanted to print the means in a single block of output, and therefore had to append the commands in the previous code block in a <code>c()</code> (combine) function.</p>
</div>
<div id="grouped-summaries" class="section level2">
<h2>Grouped summaries</h2>
<p>When we have multivariate data, such as our Big Five questionnaire responses, we can do much more than just total summaries of each of the individual variables. A common question would address the <em>group means</em> of one or many variables. This is the first step toward interesting statements about the data: How do means of Big Five personality questions vary by age? Handedness? Language? Race?</p>
<p>To answer these questions, we would like to group the data, and compute summaries of the output variables for each of the levels of a given grouping factor. <code>dplyr</code> provides an elegant way to do just that: Combining <code>summarise()</code> with <code>group_by()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d_by_gender &lt;-<span class="st"> </span><span class="kw">group_by</span>(d, gender)
<span class="kw">summarise</span>(d_by_gender, <span class="dt">mE1 =</span> <span class="kw">mean</span>(E1))</code></pre></div>
<pre><code>## Source: local data frame [4 x 2]
## 
##        gender      mE1
##        &lt;fctr&gt;    &lt;dbl&gt;
## 1 no_response 2.458333
## 2        male 2.617195
## 3      female 2.641313
## 4       other 2.147059</code></pre>
<p>Instead of taking <code>mean(E1)</code> as above, we first grouped our data frame <code>d</code> by <code>gender</code>, and <em>then</em> asked for the mean of <code>E1</code> from this new <em>grouped data frame</em>. Before continuing, I want to take a minute and reflect on the word <em>then</em>, and how R has a particularly elegant way of dealing with this verbal construction: The pipe.</p>
</div>
<div id="the-pipe" class="section level2">
<h2>The pipe</h2>
<p>When I first encountered the pipe, I was perplexed. What is this messy looking thing on each line? <code>%&gt;%</code>?? I quickly learned that the pipe connects commands and makes the code much more readable by humans. By appending that to the end of a line, we can pipe commands without either nesting commands, or saving intermediate output. For example, in the previous code chunk, <code>group_by(d, gender)</code> was nested inside the summarise function. Nesting functions inside each other quickly makes the code unreadable because while I like reading from left to right, I now must jump back and forth in the code to understand what it is doing. It would be much better if I could write a statement, <em>then</em> another, <em>then</em> yet another… As an example, consider the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(gender) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mE1 =</span> <span class="kw">mean</span>(E1))</code></pre></div>
<pre><code>## Source: local data frame [4 x 2]
## 
##        gender      mE1
##        &lt;fctr&gt;    &lt;dbl&gt;
## 1 no_response 2.458333
## 2        male 2.617195
## 3      female 2.641313
## 4       other 2.147059</code></pre>
<p>Let me read that aloud for you (Read the <code>%&gt;%</code> as simply saying “then…”):</p>
<blockquote>
<p>Take <code>d</code>, <em>then</em> group it by gender, <em>then</em> create the mean of E1.</p>
</blockquote>
<p>Because each of these lines is evaluated before the pipe operator, the <code>summarise(...)</code> line received a grouped data frame, and computed means of E1 for each level of gender.</p>
<p>Here is another example of grouping and summarising:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(gender, hand) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">m_age =</span> <span class="kw">median</span>(age),
              <span class="dt">n_obs =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## Source: local data frame [15 x 4]
## Groups: gender [?]
## 
##         gender        hand m_age n_obs
##         &lt;fctr&gt;      &lt;fctr&gt; &lt;dbl&gt; &lt;int&gt;
## 1  no_response no_response  15.5     4
## 2  no_response       right  22.5    18
## 3  no_response        both  21.0     2
## 4         male no_response  23.0    48
## 5         male       right  23.0  6652
## 6         male        left  22.0   730
## 7         male        both  20.0   177
## 8       female no_response  27.5    46
## 9       female       right  22.0 10668
## 10      female        left  22.0   987
## 11      female        both  21.0   276
## 12       other no_response  16.5     2
## 13       other       right  19.0    77
## 14       other        left  17.0     7
## 15       other        both  18.5    16</code></pre>
<p>This time, we asked for the median age for each hand and gender. Additionally, we included the number of observations for each summarised group by calling the <code>n()</code> function. Lots of right handed females!</p>
</div>
<div id="summarise-variables-row-wise" class="section level2">
<h2>Summarise variables row-wise</h2>
<p>This is a common scenario in questionnaire research: We are not necessarily as interested in individual items on a questionnaire, but rather in the subsets they form. We know that we have five categories of questionnaire items in the Big Five, so here we will create, for each individual respondent, mean values of each of the Big Five categories.</p>
<p>Here’s the recipe: We add another variable to the data frame called <code>id</code> that simply helps us understand that each row indicates one person, then group the data on <code>id</code> and create new variables for each of the Big Five items by mutating their means to item means.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>d %&gt;%
<span class="st">    </span><span class="kw">add_rownames</span>(<span class="st">&quot;id&quot;</span>) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(id) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">extraversion =</span> <span class="kw">mean</span>(<span class="kw">c</span>(E1, E2, E3, E4, E5, E6, E7, E8, E9, E10)),
           <span class="dt">openness =</span> <span class="kw">mean</span>(<span class="kw">c</span>(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10)),
           <span class="dt">agreeableness =</span> <span class="kw">mean</span>(<span class="kw">c</span>(A1, A2, A3, A4, A5, A6, A7, A8, A9, A10)),
           <span class="dt">neuroticism =</span> <span class="kw">mean</span>(<span class="kw">c</span>(N1, N2, N3, N4, N5, N6, N7, N8, N9, N10)),
           <span class="dt">conscientiousness =</span> <span class="kw">mean</span>(<span class="kw">c</span>(C1, C2, C3, C4, C5, C6, C7, C8, C9, C10))) %&gt;%
<span class="st">    </span><span class="kw">ungroup</span>()</code></pre></div>
<p><small>There are many ways to obtain row-wise summaries, including powerful functions in base-R, but here we are learning a general workflow while producing human-readable code. I hold that <code>dplyr</code> verbs are superior in these regards.</small></p>
<p>Now that we’ve reduced our data from individual items to means of the Big Five categories, it’s time to clean the data by filtering and subsetting.</p>
</div>
<div id="subsets-and-filters" class="section level2">
<h2>Subsets and filters</h2>
<p>Let’s take a moment to reflect on our data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d</code></pre></div>
<pre><code>## Source: local data frame [19,710 x 63]
## 
##       id                  race   age engnat gender   hand source country
##    &lt;chr&gt;                &lt;fctr&gt; &lt;int&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;int&gt;   &lt;chr&gt;
## 1      1    caucasian_european    53    yes   male  right      1      US
## 2      2                 other    46    yes female  right      1      US
## 3      3            mixed_race    14     no female  right      1      PK
## 4      4    caucasian_european    19     no female  right      1      RO
## 5      5      south_east_asian    25     no female  right      2      US
## 6      6                 other    31    yes female  right      2      US
## 7      7 caucasian_middle_east    20    yes female  right      5      US
## 8      8      caucasian_indian    23     no   male  right      2      IN
## 9      9 caucasian_middle_east    39    yes female   both      4      US
## 10    10    caucasian_european    18    yes female  right      5      US
## ..   ...                   ...   ...    ...    ...    ...    ...     ...
## Variables not shown: E1 &lt;int&gt;, E2 &lt;int&gt;, E3 &lt;int&gt;, E4 &lt;int&gt;, E5 &lt;int&gt;, E6
##   &lt;int&gt;, E7 &lt;int&gt;, E8 &lt;int&gt;, E9 &lt;int&gt;, E10 &lt;int&gt;, N1 &lt;int&gt;, N2 &lt;int&gt;, N3
##   &lt;int&gt;, N4 &lt;int&gt;, N5 &lt;int&gt;, N6 &lt;int&gt;, N7 &lt;int&gt;, N8 &lt;int&gt;, N9 &lt;int&gt;, N10
##   &lt;int&gt;, A1 &lt;int&gt;, A2 &lt;int&gt;, A3 &lt;int&gt;, A4 &lt;int&gt;, A5 &lt;int&gt;, A6 &lt;int&gt;, A7
##   &lt;int&gt;, A8 &lt;int&gt;, A9 &lt;int&gt;, A10 &lt;int&gt;, C1 &lt;int&gt;, C2 &lt;int&gt;, C3 &lt;int&gt;, C4
##   &lt;int&gt;, C5 &lt;int&gt;, C6 &lt;int&gt;, C7 &lt;int&gt;, C8 &lt;int&gt;, C9 &lt;int&gt;, C10 &lt;int&gt;, O1
##   &lt;int&gt;, O2 &lt;int&gt;, O3 &lt;int&gt;, O4 &lt;int&gt;, O5 &lt;int&gt;, O6 &lt;int&gt;, O7 &lt;int&gt;, O8
##   &lt;int&gt;, O9 &lt;int&gt;, O10 &lt;int&gt;, extraversion &lt;dbl&gt;, openness &lt;dbl&gt;,
##   agreeableness &lt;dbl&gt;, neuroticism &lt;dbl&gt;, conscientiousness &lt;dbl&gt;.</code></pre>
<p>Although we just computed the by-person summaries of each of the Big Five items, we don’t actually see this in the output, because the data frame contains so many variables. We would therefore like to subset our data.</p>
<div id="subset-like-a-pro-select" class="section level3">
<h3>Subset like a pro: <code>select()</code></h3>
<p>There is an in-built R function <code>subset()</code> that takes subsets of data, but we embrace the modular nature of <code>dplyr</code> verbs, and focus on <code>select()</code> instead. First, we would like to remove <code>source</code> and all the individual Big Five items:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(d, 
       -source,
       -<span class="kw">starts_with</span>(<span class="st">&quot;E&quot;</span>, <span class="dt">ignore.case=</span>F),
       -<span class="kw">starts_with</span>(<span class="st">&quot;O&quot;</span>, <span class="dt">ignore.case=</span>F),
       -<span class="kw">starts_with</span>(<span class="st">&quot;N&quot;</span>, <span class="dt">ignore.case=</span>F),
       -<span class="kw">starts_with</span>(<span class="st">&quot;C&quot;</span>, <span class="dt">ignore.case=</span>F),
       -<span class="kw">starts_with</span>(<span class="st">&quot;A&quot;</span>, <span class="dt">ignore.case=</span>F))</code></pre></div>
<pre><code>## Source: local data frame [19,710 x 12]
## 
##       id                  race   age engnat gender   hand country
##    &lt;chr&gt;                &lt;fctr&gt; &lt;int&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;   &lt;chr&gt;
## 1      1    caucasian_european    53    yes   male  right      US
## 2      2                 other    46    yes female  right      US
## 3      3            mixed_race    14     no female  right      PK
## 4      4    caucasian_european    19     no female  right      RO
## 5      5      south_east_asian    25     no female  right      US
## 6      6                 other    31    yes female  right      US
## 7      7 caucasian_middle_east    20    yes female  right      US
## 8      8      caucasian_indian    23     no   male  right      IN
## 9      9 caucasian_middle_east    39    yes female   both      US
## 10    10    caucasian_european    18    yes female  right      US
## ..   ...                   ...   ...    ...    ...    ...     ...
## Variables not shown: extraversion &lt;dbl&gt;, openness &lt;dbl&gt;, agreeableness
##   &lt;dbl&gt;, neuroticism &lt;dbl&gt;, conscientiousness &lt;dbl&gt;.</code></pre>
<p><code>select()</code> takes a data frame as its first argument, followed by arbitrarily many variables in that data frame that you would like to include or exclude. Because we appended a <code>-</code> to <code>source</code>, we requested that it be excluded. The following lines are slightly more complicated, but do many tasks at once.</p>
<p><code>-starts_with(&quot;E&quot;, ignore.case=F)</code> says that we would like to select every variable that starts with an E, specify that case should not be ignored (because we don’t want to select variables beginning with small <em>e</em>), and exclude these variables by starting the command with a negation. As a result, the printed data frame is now much cleaner to look at.</p>
<p>Notice that I didn’t actually save the output anywhere. Temporary objects and files simply clutter our workspace and project folders, so we try to abstain from producing intermediate data files.</p>
</div>
<div id="exclude-and-include-cases-filter" class="section level3">
<h3>Exclude and include cases: <code>filter()</code></h3>
<p>Recall that we had some pretty bizarre entries in the age field (13, 999999999). Therefore our next operation will be to exclude cases (rows), in which the age entry is outside some reasonable criteria, say 13 and 99.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">filter</span>(d, <span class="kw">between</span>(age, <span class="dv">13</span>, <span class="dv">99</span>))
<span class="kw">range</span>(d$age)</code></pre></div>
<pre><code>## [1] 13 99</code></pre>
<p>Sweet! I also surreptitiously introduced you to a logical shortcut: <code>between()</code>. Although we could do the same operation by calling native R logical operators, once again, human readability wins. For completeness, here is the same operation with just logical operators:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">filter</span>(d, age &gt;=<span class="st"> </span><span class="dv">13</span> &amp;<span class="st"> </span>age &lt;=<span class="st"> </span><span class="dv">99</span>)</code></pre></div>
<p>In the future, you can choose which one pleases your eye most. Logical operators are often needed, but <code>between()</code> is a pretty cool shortcut. Just make sure that you know whether the boundary values are included or not (they are, by default, when calling <code>between()</code>.)</p>
</div>
</div>
<div id="first-plot" class="section level2">
<h2>First plot</h2>
<p>We now have readable and clean data, and know that we can print it in the console by simply typing <code>d</code>. But we would like to <strong>see</strong> the data!</p>
<p>Let’s take all the commands we’ve learned so far, put them into a single piped chain of commands, and instead of simply printing the results, we’ll pass them into a plotting function. Try to read the code before viewing the plot, and guess what the plot might look like. The code is so readable that we can almost see the plot in our minds eyes by just reading the code!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d %&gt;%
<span class="st">    </span><span class="kw">filter</span>(gender %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(race, gender) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">agreeableness =</span> <span class="kw">mean</span>(agreeableness),
              <span class="dt">openness =</span> <span class="kw">mean</span>(openness),
              <span class="dt">neuroticism =</span> <span class="kw">mean</span>(neuroticism),
              <span class="dt">extraversion =</span> <span class="kw">mean</span>(extraversion)) %&gt;%
<span class="st">    </span><span class="co"># Melt into long format suitable for plotting</span>
<span class="st">    </span><span class="kw">melt</span>(<span class="dt">variable.name =</span> <span class="st">&quot;item&quot;</span>, <span class="dt">value.name =</span> <span class="st">&quot;mean_rating&quot;</span>) %&gt;%
<span class="st">    </span><span class="co"># Plot it already!</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean_rating, <span class="dt">y =</span> race, <span class="dt">col =</span> gender)) +
<span class="st">    </span><span class="kw">geom_point</span>() +
<span class="st">    </span><span class="kw">facet_wrap</span>(~item)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="questionnaire_files/figure-html/unnamed-chunk-15-1.png" alt="Four categories across race and gender." width="768" />
<p class="caption">
Four categories across race and gender.
</p>
</div>
<p>Great! I again introduced a new operator (<code>%in%</code>; we only included genders that match the two strings “female” and “male”), then grouped the data, computed summaries, <a href="reshape.html">reshaped</a> and plotted the data.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-wickham_dplyr:_2015">
<p>Wickham, H., &amp; Francois, R. (2015a). <em>Dplyr: A grammar of data manipulation</em>. Retrieved from <a href="http://CRAN.R-project.org/package=dplyr" class="uri">http://CRAN.R-project.org/package=dplyr</a></p>
</div>
<div id="ref-wickham_readr:_2015">
<p>Wickham, H., &amp; Francois, R. (2015b). <em>Readr: Read tabular data</em>. Retrieved from <a href="http://CRAN.R-project.org/package=readr" class="uri">http://CRAN.R-project.org/package=readr</a></p>
</div>
</div>
</div>

<!DOCTYPE HTML>
<!--custom footer for all pages-->
<!--centered text class-->
<style type="text/css">
.center {
    margin: auto;
    text-align: center;
    width: 60%;
    padding: 10px;
}
</style>
<hr>
<p class="center">
<a href="https://zenodo.org/badge/latestdoi/20002/mvuorre/toolbox"><img src="https://zenodo.org/badge/20002/mvuorre/toolbox.svg" alt="DOI"></a>
</p>
<br>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
